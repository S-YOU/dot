#!/usr/bin/env ruby

usage = <<'EOF'
使用例:
    fn \*.c
    fn \*.c -vi
    fn \*.c -ls
EOF

def system_e(*args)
  system(*args) || (p args; raise "Error: command failed")
end

@ignore_case = true

cmd = nil

args = ARGV

commands = {
  "vi" => "vim",
  "ls" => "ls -l",
}

commands.each do |k, v|
  flag = "-" + k
  if args.include?(flag)
    args = args.select {|x| x != flag}
    cmd = v
  end
end

if args.length == 0
  print usage
elsif args.length == 1
  name = args[0]
  if ENV["FN_ROOT"].to_s == ""
    dir = "."
  else
    dir = ENV["FN_ROOT"]
  end
else
  dir = args[0]
  name = args[1]
end

# 検索語が大文字を含んでいる場合はケースセンシティブ
if name.downcase != name
  @ignore_case = false
end

name_option = @ignore_case ? "-iname" : "-name"

if cmd
  system_e("#{cmd} $(find #{dir} #{name_option} '#{name}')")
else
  system_e("find #{dir} #{name_option} '#{name}'")
end
