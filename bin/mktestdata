#!/usr/bin/env ruby
#
# coding: utf-8
#
# テストデータをランダムに生成するスクリプト

# 使用法を表示する
def usage
  STDOUT.print <<EOF
使用法：
$ mktestdata
でgenerate.rbが生成されるので、このファイルを編集します。そして
$ ruby generate.rb
でテストデータが生成されます。
EOF
end


require 'date'
require 'json'

# テストデータを生成するクラス
class TestDataGenerator
  attr_reader :columns
  attr_accessor :printer

  def self.template
    str = <<EOF
#================================================================
# テストデータを生成するスクリプト
#================================================================

load '#{$0}'

count = (ARGV[0] ? ARGV[0].to_i : 5)

a = TestDataGenerator.new(table_name: 'table_name')
a.add('id') {|t| t.id }
a.add('sei') {|t| t.name1 }
a.add('mei') {|t| t.name2 }
a.add('seikana') {|t| t.name1_katakana }
a.add('meikana') {|t| t.name2_katakana }
a.add('age') {|t| t.integer(10, 90) }
a.add('tel') {|t| t.tel }
a.add('postcode') {|t| t.postcode}
a.add('prefecture') {|t| t.address1}
a.add('city') {|t| t.address2}
a.add('birth') {|t| t.date}
a.add('created') {|t| t.datetime('2000-01-01', '2010-10-01')}
a.add('sex') {|t| t.enum( ['男', '女'])}
a.add('bool') {|t| t.enum( [1, 0])}
a.add('memo') {|t| t.ref('sei') + t.ref('mei') + 'さんの合言葉：' + t.string(10) }

a.out('output.sql', count)
EOF
  end

  def initialize(table_name: 'table_name')
    @table_name = table_name

    # ID生成用
    @id = 1

    # カラム定義の配列
    @columns = []
  end

  def add(column_name, &proc)
    @columns << {
      :column_name => column_name,
      :field_generator => proc
    }
  end

  def out(filename, count, &formatter)
    $stdout = open(filename, 'w')
    STDERR.write "作成中 #{filename}\n"

    start_time = Time.now

    if @printer.nil?
      if filename =~ /\.sql$/i
        printer = SQLPrinter.new
      elsif filename =~ /\.json$/i
        printer = JSONPrinter.new
      elsif filename =~ /\.csv$/i
        printer = CSVPrinter.new
        printer.separator = ","
      elsif filename =~ /\.tsv$/i
        printer = CSVPrinter.new
        printer.separator = "\t"
      else
        STDERR.puts "Error: 不明な拡張子です"
        exit(1)
      end
    else
      printer = @printer
    end

    printer.table_name = @table_name
    printer.columns = @columns

    print printer.print_header
    count.times do |i|
      row = make_array
      print printer.print_row(row, i, count)
      STDERR.write "\r#{i}/#{count}"
    end
    print printer.print_footer

    STDERR.write "\r#{count}/#{count}\n"
    STDERR.write "#{sprintf('%.3fs', Time.now - start_time)}\n"
  end

  def make_array
    @tmp_row = []
    @tmp_hash = {}
    name1 = @@name1_list.sample
    name2 = @@name2_list.sample
    @name1 = name1[0]
    @name1_hiragana = name1[1]
    @name1_katakana = name1[2]
    @name2 = name2[0]
    @name2_hiragana = name2[1]
    @name2_katakana = name2[2]
    @columns.each_with_index do |column, i|
      value = column[:field_generator].call(self)
      @tmp_row << value
      @tmp_hash[column[:column_name]] = value
    end
    @id += 1
    return @tmp_row
  end

  #-----------------------------------------------------------------------------
  #    データ生成用メソッド
  #-----------------------------------------------------------------------------

  def ref(column_name)
    @tmp_hash[column_name]
  end

  def id(start=1, step=1)
    @id
  end

  def integer(min, max)
    min + rand(max - min + 1)
  end

  def float(min, max)
    min + rand() * (max - min)
  end

  def string(maxlen)
    ret = ''
    len = 1 + rand(maxlen - 1)
    return (0...len).map { @@char_list.sample }.join
  end

  def enum(list)
    list.sample
  end

  def name1
    @name1
  end

  def name1_hiragana
    @name1_hiragana
  end

  def name1_katakana
    @name1_katakana
  end

  def name2
    @name2
  end

  def name2_hiragana
    @name2_hiragana
  end

  def name2_katakana
    @name2_katakana
  end

  def name
    name1 + '　' + name2
  end

  def name_hiragana
    name1_hiragana + '　' + name2_hiragana
  end

  def name_katakana
    name1_katakana + '　' + name2_katakana
  end

  def address1
    @@prefecture_list.sample
  end

  def address2
    sprintf('%s市 %s %d-%d-%d', @@name1_list.sample[0], @@name1_list.sample[0], (1 + rand(9)), (1 + rand(9)), (1 + rand(9)))
  end

  def address
    address1 + address2
  end

  def tel
    sprintf('%s-%04d-%04d', ['03', '090', '050', '042', '080'].sample, rand(10000), rand(10000))
  end

  def telno
    tel
  end

  def postcode
    @@postcode_list.sample
  end

  def date(d_from='1920-01-01', d_to='2015-01-01')
      from = Date.parse(d_from)
      to = Date.parse(d_to)
      days = to - from + 1
      return (from + rand(days)).to_s
  end

  def datetime(d_from='1920-01-01', d_to='2015-01-01')
    return date(d_from, d_to) + sprintf(' %02d:%02d:%02d', rand(24), rand(60), rand(60))
  end

  #--- クラス変数 --------------------------------------------------------------------------

  # 名前のリストはここから
  # http://www2s.biglobe.ne.jp/~suzakihp/ju0001.html
  # http://kazina.com/dummy/
  @@name1_list = [ ['佐藤', 'さとう', 'サトウ'], ['鈴木', 'すずき', 'スズキ'], ['高橋', 'たかはし', 'タカハシ'], ['田中', 'たなか', 'タナカ'], ['渡辺', 'わたなべ', 'ワタナベ'], ['伊藤', 'いとう', 'イトウ'], ['山本', 'やまもと', 'ヤマモト'], ['中村', 'なかむら', 'ナカムラ'], ['小林', 'こばやし', 'コバヤシ'], ['加藤', 'かとう', 'カトウ'], ['吉田', 'よしだ', 'ヨシダ'], ['山田', 'やまだ', 'ヤマダ'], ['佐々木', 'ささき', 'ササキ'], ['山口', 'やまぐち', 'ヤマグチ'], ['松本', 'まつもと', 'マツモト'], ['井上', 'いのうえ', 'イノウエ'], ['斎藤', 'さいとう', 'サイトウ'], ['木村', 'きむら', 'キムラ'], ['林', 'はやし', 'ハヤシ'], ['林', 'りん', 'リン'], ['清水', 'しみず', 'シミズ'], ['山崎', 'やまさき', 'ヤマサキ'], ['池田', 'いけだ', 'イケダ'], ['阿部', 'あべ', 'アベ'], ['森', 'もり', 'モリ'], ['橋本', 'はしもと', 'ハシモト'], ['山下', 'やました', 'ヤマシタ'], ['石川', 'いしかわ', 'イシカワ'], ['中島', 'なかしま', 'ナカシマ'], ['前田', 'まえた', 'マエタ'], ['藤田', 'ふじた', 'フジタ'], ['小川', 'おがわ', 'オガワ'], ['岡田', 'おかだ', 'オカダ'], ['後藤', 'ごとう', 'ゴトウ'], ['長谷川', 'はせがわ', 'ハセガワ'], ['村上', 'さむらかみ', 'サムラカミ'], ['村上', 'むらかみ', 'ムラカミ'], ['近藤', 'こんどう', 'コンドウ'], ['石井', 'いしい', 'イシイ'], ['坂本', 'さかもと', 'サカモト'], ['遠藤', 'えんどう', 'エンドウ'], ['青木', 'あおき', 'アオキ'], ['藤井', 'ふじい', 'フジイ'], ['西村', 'にしむら', 'ニシムラ'], ['福田', 'ふくた', 'フクタ'], ['太田', 'おおた', 'オオタ'], ['太田', 'ただ', 'タダ'], ['三浦', 'みうら', 'ミウラ'], ['藤原', 'ふじわら', 'フジワラ'], ['岡本', 'おかもと', 'オカモト'], ['松田', 'まつだ', 'マツダ'], ['斉藤', 'さいとう', 'サイトウ'], ['中川', 'なかがわ', 'ナカガワ'], ['中野', 'なかの', 'ナカノ'], ['原田', 'はらた', 'ハラタ'], ['小野', 'おの', 'オノ'], ['竹内', 'たけうち', 'タケウチ'], ['田村', 'たむら', 'タムラ'], ['金子', 'かねこ', 'カネコ'], ['和田', 'わだ', 'ワダ'], ['中山', 'なかやま', 'ナカヤマ'], ['石田', 'いしだ', 'イシダ'], ['上田', 'かみた', 'カミタ'], ['森田', 'もりた', 'モリタ'], ['原', 'はら', 'ハラ'], ['柴田', 'しばた', 'シバタ'], ['酒井', 'さかい', 'サカイ'], ['工藤', 'くどう', 'クドウ'], ['横山', 'よこやま', 'ヨコヤマ'], ['宮崎', 'みやざき', 'ミヤザキ'], ['宮本', 'みやもと', 'ミヤモト'], ['内田', 'うちだ', 'ウチダ'], ['高木', 'たかき', 'タカキ'], ['安藤', 'あんどう', 'アンドウ'], ['谷口', 'たにぐち', 'タニグチ'], ['大野', 'おおの', 'オオノ'], ['今井', 'いまい', 'イマイ'], ['丸山', 'まるやま', 'マルヤマ'], ['高田', 'たかだ', 'タカダ'], ['河野', 'こうの', 'コウノ'], ['藤本', 'ふじもと', 'フジモト'], ['小島', 'おじま', 'オジマ'], ['武田', 'たけだ', 'タケダ'], ['村田', 'むらた', 'ムラタ'], ['上野', 'うえの', 'ウエノ'], ['杉山', 'すぎやま', 'スギヤマ'], ['増田', 'ますだ', 'マスダ'], ['菅原', 'すがはら', 'スガハラ'], ['平野', 'ひらの', 'ヒラノ'], ['小山', 'こやま', 'コヤマ'], ['大塚', 'おおつか', 'オオツカ'], ['久保', 'くぼ', 'クボ'], ['千葉', 'ちば', 'チバ'], ['松井', 'まつい', 'マツイ'], ['岩崎', 'いわさき', 'イワサキ'], ['野口', 'のぐち', 'ノグチ'], ['松尾', 'まつお', 'マツオ'], ['木下', 'きした', 'キシタ'], ['菊地', 'きくち', 'キクチ'], ['野村', 'のむら', 'ノムラ'], ['佐野', 'さの', 'サノ'], ['渡部', 'わたなべ', 'ワタナベ'], ['新井', 'あらい', 'アライ'], ['杉本', 'すぎもと', 'スギモト'], ['大西', 'おおにし', 'オオニシ'], ['桜井', 'さくらい', 'サクライ'], ['古川', 'こがわ', 'コガワ'], ['市川', 'いちかわ', 'イチカワ'], ['島田', 'しまだ', 'シマダ'], ['小松', 'こまつ', 'コマツ'], ['高野', 'こうの', 'コウノ'], ['水野', 'みずの', 'ミズノ'], ['吉川', 'きちかわ', 'キチカワ'], ['吉川', 'よしかわ', 'ヨシカワ'], ['山内', 'やまうち', 'ヤマウチ'], ['西田', 'にした', 'ニシタ'], ['菊池', 'きくち', 'キクチ'], ['西川', 'にしかわ', 'ニシカワ'], ['北村', 'きたむら', 'キタムラ'], ['浜田', 'はまだ', 'ハマダ'], ['五十嵐', 'いからし', 'イカラシ'], ['安田', 'やすた', 'ヤスタ'], ['中田', 'なかた', 'ナカタ'], ['川口', 'かわぐち', 'カワグチ'], ['平田', 'ひらた', 'ヒラタ'], ['川崎', 'かわさき', 'カワサキ'], ['東', 'あずま', 'アズマ'], ['東', 'ひがし', 'ヒガシ'], ['飯田', 'いいだ', 'イイダ'], ['本田', 'ほんだ', 'ホンダ'], ['久保田', 'くぼた', 'クボタ'], ['吉村', 'よしむら', 'ヨシムラ'], ['辻', 'つじ', 'ツジ'], ['関', 'せき', 'セキ'], ['中西', 'なかにし', 'ナカニシ'], ['福島', 'ふくしま', 'フクシマ'], ['岩田', 'いわた', 'イワタ'], ['服部', 'はっとり', 'ハットリ'], ['樋口', 'ひぐち', 'ヒグチ'], ['川上', 'かわかみ', 'カワカミ'], ['松岡', 'まつおか', 'マツオカ'], ['永井', 'ながい', 'ナガイ'], ['山中', 'やまなか', 'ヤマナカ'], ['田口', 'たぐち', 'タグチ'], ['森本', 'もりもと', 'モリモト'], ['矢野', 'やの', 'ヤノ'], ['秋山', 'あきやま', 'アキヤマ'], ['土屋', 'つちや', 'ツチヤ'], ['石原', 'いしはら', 'イシハラ'], ['松下', 'まつした', 'マツシタ'], ['馬場', 'ばば', 'ババ'], ['大橋', 'おおはし', 'オオハシ'], ['吉岡', 'よしおか', 'ヨシオカ'], ['松浦', 'まつうら', 'マツウラ'], ['小池', 'こいけ', 'コイケ'], ['浅野', 'あさの', 'アサノ'], ['大久保', 'おおくぼ', 'オオクボ'], ['熊谷', 'くまがい', 'クマガイ'], ['熊谷', 'くまたに', 'クマタニ'], ['荒木', 'あらき', 'アラキ'], ['野田', 'のだ', 'ノダ'], ['川村', 'かわむら', 'カワムラ'], ['星野', 'ほしの', 'ホシノ'], ['広瀬', 'ひろせ', 'ヒロセ'], ['大谷', 'おおたに', 'オオタニ'], ['黒田', 'くろた', 'クロタ'], ['尾崎', 'おざき', 'オザキ'], ['田辺', 'たなべ', 'タナベ'], ['永田', 'えいだ', 'エイダ'], ['永田', 'ながた', 'ナガタ'], ['松村', 'まつむら', 'マツムラ'], ['望月', 'ぼうづき', 'ボウヅキ'], ['望月', 'もちづき', 'モチヅキ'], ['堀', 'ほり', 'ホリ'], ['内藤', 'ないとう', 'ナイトウ'], ['菅野', 'かんの', 'カンノ'], ['菅野', 'すがの', 'スガノ'], ['西山', 'にしやま', 'ニシヤマ'], ['大島', 'おおしま', 'オオシマ'], ['平井', 'ひらい', 'ヒライ'], ['岩本', 'いわもと', 'イワモト'], ['片山', 'かたやま', 'カタヤマ'], ['沢田', 'さわだ', 'サワダ'], ['本間', 'ほんま', 'ホンマ'], ['早川', 'はやかわ', 'ハヤカワ'], ['横田', 'よこた', 'ヨコタ'], ['荒井', 'あらい', 'アライ'], ['岡崎', 'おかざき', 'オカザキ'], ['鎌田', 'かまた', 'カマタ'], ['大石', 'おおいし', 'オオイシ'], ['成田', 'なりた', 'ナリタ'], ['小田', 'おだ', 'オダ'], ['宮田', 'みやた', 'ミヤタ'], ['石橋', 'いしばし', 'イシバシ'], ['須藤', 'すとう', 'ストウ'], ['篠原', 'しのはら', 'シノハラ'], ['萩原', 'はぎわら', 'ハギワラ'], ['高山', 'たかやま', 'タカヤマ'], ['小西', 'こにし', 'コニシ'], ['栗原', 'くりはら', 'クリハラ'], ['松原', 'まつばら', 'マツバラ'], ['伊東', 'いとう', 'イトウ'], ['三宅', 'みやけ', 'ミヤケ'], ['福井', 'ふくい', 'フクイ'], ['小沢', 'おざわ', 'オザワ'], ['南', 'みなみ', 'ミナミ'], ['大森', 'おおもり', 'オオモリ'], ['奥村', 'おくむら', 'オクムラ'], ['片岡', 'かたおか', 'カタオカ'], ['内山', 'うちやま', 'ウチヤマ'], ['桑原', 'くわはら', 'クワハラ'], ['岡', 'おか', 'オカ'], ['富田', 'とくだ', 'トクダ'], ['富田', 'とみた', 'トミタ'], ['関口', 'せきぐち', 'セキグチ'], ['松永', 'まつなが', 'マツナガ'], ['奥田', 'おくた', 'オクタ'], ['北川', 'きたかわ', 'キタカワ'], ['古賀', 'こが', 'コガ'], ['上原', 'うえはら', 'ウエハラ'], ['上原', 'かみはら', 'カミハラ'], ['八木', 'やぎ', 'ヤギ'], ['吉野', 'よしの', 'ヨシノ'], ['白石', 'しらいし', 'シライシ'], ['今村', 'いまむら', 'イマムラ'], ['川島', 'かわしま', 'カワシマ'], ['上村', 'うえむら', 'ウエムラ'], ['小泉', 'こいずみ', 'コイズミ'], ['中尾', 'なかお', 'ナカオ'], ['青山', 'あおやま', 'アオヤマ'], ['平山', 'ひらやま', 'ヒラヤマ'], ['牧野', 'まきの', 'マキノ'], ['寺田', 'てらだ', 'テラダ'], ['渋谷', 'しぶたに', 'シブタニ'], ['岡村', 'おかむら', 'オカムラ'], ['児玉', 'こだま', 'コダマ'], ['坂口', 'さかぐち', 'サカグチ'], ['河合', 'かあい', 'カアイ'], ['大山', 'おおやま', 'オオヤマ'], ['多田', 'ただ', 'タダ'], ['小野寺', 'おのでら', 'オノデラ'], ['宮下', 'みやした', 'ミヤシタ'], ['小倉', 'おぐら', 'オグラ'], ['竹田', 'たけだ', 'タケダ'], ['足立', 'あだち', 'アダチ'], ['小笠原', 'おがさはら', 'オガサハラ'], ['天野', 'あまの', 'アマノ'], ['村山', 'むらやま', 'ムラヤマ'], ['坂井', 'さかい', 'サカイ'], ['西', 'にし', 'ニシ'], ['杉浦', 'すぎうら', 'スギウラ'], ['坂田', 'さかた', 'サカタ'], ['小原', 'おはら', 'オハラ'], ['小原', 'こはら', 'コハラ'], ['豊田', 'とよた', 'トヨタ'], ['河村', 'かわむら', 'カワムラ'], ['武藤', 'むとう', 'ムトウ'], ['角田', 'かくた', 'カクタ'], ['角田', 'つのだ', 'ツノダ'], ['水谷', 'すいたに', 'スイタニ'], ['水谷', 'みずたに', 'ミズタニ'], ['根本', 'ねもと', 'ネモト'], ['関根', 'せきね', 'セキネ'], ['森下', 'もりした', 'モリシタ'], ['中井', 'なかい', 'ナカイ'], ['神田', 'かんだ', 'カンダ'], ['神田', 'こうだ', 'コウダ'], ['田島', 'たしま', 'タシマ'], ['植田', 'うえた', 'ウエタ'], ['塚本', 'つかもと', 'ツカモト'], ['佐久間', 'さくま', 'サクマ'], ['飯塚', 'いいつか', 'イイツカ'], ['飯塚', 'めしづか', 'メシヅカ'], ['前川', 'まえかわ', 'マエカワ'], ['安部', 'あべ', 'アベ'], ['浅井', 'あさい', 'アサイ'], ['山根', 'やまね', 'ヤマネ'], ['白井', 'しらい', 'シライ'], ['宮川', 'みやかわ', 'ミヤカワ'], ['岡部', 'おかべ', 'オカベ'], ['大沢', 'おおさわ', 'オオサワ'], ['大川', 'おおかわ', 'オオカワ'], ['長田', 'おさだ', 'オサダ'], ['長田', 'ながた', 'ナガタ'], ['堀内', 'ほりうち', 'ホリウチ'], ['稲垣', 'いながき', 'イナガキ'], ['若林', 'わかばやし', 'ワカバヤシ'], ['松崎', 'まつさき', 'マツサキ'], ['榎本', 'えのもと', 'エノモト'], ['森山', 'もりやま', 'モリヤマ'], ['神谷', 'かみたに', 'カミタニ'], ['神谷', 'こうや', 'コウヤ'], ['神谷', 'しんたに', 'シンタニ'], ['中沢', 'なかざわ', 'ナカザワ'], ['江口', 'えぐち', 'エグチ'], ['中谷', 'なかたに', 'ナカタニ'], ['畠山', 'はたけやま', 'ハタケヤマ'], ['谷', 'たに', 'タニ'], ['及川', 'おいかわ', 'オイカワ'], ['細川', 'ほそかわ', 'ホソカワ'], ['三上', 'みかみ', 'ミカミ'], ['今野', 'こんの', 'コンノ'], ['西尾', 'にしお', 'ニシオ'], ['安達', 'あだち', 'アダチ'], ['田代', 'たしろ', 'タシロ'], ['飯島', 'いいじま', 'イイジマ'], ['石塚', 'いしづか', 'イシヅカ'], ['津田', 'つだ', 'ツダ'], ['岸本', 'きしもと', 'キシモト'], ['荒川', 'あらかわ', 'アラカワ'], ['中原', 'なかはら', 'ナカハラ'], ['長尾', 'ながお', 'ナガオ'], ['土井', 'どい', 'ドイ'], ['本多', 'ほんだ', 'ホンダ'], ['森川', 'もりかわ', 'モリカワ'], ['三好', 'みよし', 'ミヨシ'], ['戸田', 'とだ', 'トダ'], ['金井', 'かない', 'カナイ'], ['米田', 'こめた', 'コメタ'] ]
  @@name2_list = [ ['和久', 'かずひさ', 'カズヒサ'], ['早織', 'さおり', 'サオリ'], ['茜', 'あかね', 'アカネ'], ['勝久', 'かつひさ', 'カツヒサ'], ['窈', 'よう', 'ヨウ'], ['照生', 'てるお', 'テルオ'], ['優', 'ゆう', 'ユウ'], ['ヒロ', 'ひろ', 'ヒロ'], ['美佐', 'みさ', 'ミサ'], ['れいな', 'れいな', 'レイナ'], ['めぐみ', 'めぐみ', 'メグミ'], ['完爾', 'かんじ', 'カンジ'], ['さやか', 'さやか', 'サヤカ'], ['真悠子', 'まゆこ', 'マユコ'], ['美月', 'みづき', 'ミヅキ'], ['正義', 'まさよし', 'マサヨシ'], ['真悠子', 'まゆこ', 'マユコ'], ['優', 'ゆう', 'ユウ'], ['俊二', 'しゅんじ', 'シュンジ'], ['丈史', 'たけし', 'タケシ'], ['雅之', 'まさゆき', 'マサユキ'], ['基祐', 'きすけ', 'キスケ'], ['雅彦', 'まさひこ', 'マサヒコ'], ['真帆', 'まほ', 'マホ'], ['ひとみ', 'ひとみ', 'ヒトミ'], ['樹里', 'じゅり', 'ジュリ'], ['春樹', 'はるき', 'ハルキ'], ['美佐', 'みさ', 'ミサ'], ['薫', 'かおる', 'カオル'], ['恵梨香', 'えりか', 'エリカ'], ['光', 'ひかる', 'ヒカル'], ['一樹', 'かずき', 'カズキ'], ['朝陽', 'あさひ', 'アサヒ'], ['涼', 'りょう', 'リョウ'], ['洋介', 'ようすけ', 'ヨウスケ'], ['あき', 'あき', 'アキ'], ['あや子', 'あやこ', 'アヤコ'], ['蒼甫', 'そうすけ', 'ソウスケ'], ['勤', 'つとむ', 'ツトム'], ['寛', 'ひろし', 'ヒロシ'], ['豊', 'ゆたか', 'ユタカ'], ['充則', 'みつのり', 'ミツノリ'], ['えみ', 'えみ', 'エミ'], ['淳', 'あつし', 'アツシ'], ['翔子', 'しょうこ', 'ショウコ'], ['さやか', 'さやか', 'サヤカ'], ['有海', 'あみ', 'アミ'], ['龍吉', 'りゅうきち', 'リュウキチ'], ['洋', 'よう', 'ヨウ'], ['育子', 'いくこ', 'イクコ'], ['浩介', 'こうすけ', 'コウスケ'], ['丈史', 'たけし', 'タケシ'], ['賢二', 'けんじ', 'ケンジ'], ['雄太', 'ゆうた', 'ユウタ'], ['守', 'まもる', 'マモル'], ['啓介', 'けいすけ', 'ケイスケ'], ['瞬', 'しゅん', 'シュン'], ['晋也', 'しんや', 'シンヤ'], ['薫', 'かおる', 'カオル'], ['ひかり', 'ひかり', 'ヒカリ'], ['ジローラモ', 'じろーらも', 'ジローラモ'], ['聖陽', 'まさあき', 'マサアキ'], ['俊二', 'しゅんじ', 'シュンジ'], ['竜也', 'たつや', 'タツヤ'], ['詩織', 'しおり', 'シオリ'], ['恵望子', 'えみこ', 'エミコ'], ['晴臣', 'はるおみ', 'ハルオミ'], ['恭子', 'きょうこ', 'キョウコ'], ['窈', 'よう', 'ヨウ'], ['コウ', 'こう', 'コウ'], ['千夏', 'ちなつ', 'チナツ'], ['慶太', 'けいた', 'ケイタ'], ['恵梨香', 'えりか', 'エリカ'], ['朝陽', 'あさひ', 'アサヒ'], ['隆太', 'りゅうた', 'リュウタ'], ['剛基', 'よしき', 'ヨシキ'], ['沙耶', 'さや', 'サヤ'], ['一', 'はじめ', 'ハジメ'], ['優', 'ゆう', 'ユウ'], ['沙知絵', 'さちえ', 'サチエ'], ['竜也', 'たつや', 'タツヤ'], ['圭', 'けい', 'ケイ'], ['徹', 'とおる', 'トオル'], ['莉央', 'りお', 'リオ'], ['璃子', 'りこ', 'リコ'], ['里穂', 'りほ', 'リホ'], ['由宇', 'ゆう', 'ユウ'], ['建', 'けん', 'ケン'], ['ヒカル', 'ひかる', 'ヒカル'], ['美智子', 'みちこ', 'ミチコ'], ['法子', 'のりこ', 'ノリコ'], ['剛基', 'よしき', 'ヨシキ'], ['フミヤ', 'ふみや', 'フミヤ'], ['勇介', 'ゆうすけ', 'ユウスケ'], ['一', 'はじめ', 'ハジメ'], ['和久', 'かずひさ', 'カズヒサ'], ['雅彦', 'まさひこ', 'マサヒコ'], ['兼', 'けん', 'ケン'], ['路子', 'みちこ', 'ミチコ'], ['小百合', 'さゆり', 'サユリ'], ['綾女', 'あやめ', 'アヤメ'], ['誠治', 'せいじ', 'セイジ'], ['あや子', 'あやこ', 'アヤコ'], ['文世', 'ふみよ', 'フミヨ'], ['まみ', 'まみ', 'マミ'], ['なつみ', 'なつみ', 'ナツミ'], ['ちえみ', 'ちえみ', 'チエミ'], ['恵梨香', 'えりか', 'エリカ'], ['蒼甫', 'そうすけ', 'ソウスケ'], ['信輔', 'しんすけ', 'シンスケ'], ['精児', 'せいじ', 'セイジ'], ['彩華', 'あやか', 'アヤカ'], ['ひろ子', 'ひろこ', 'ヒロコ'], ['奈央', 'なお', 'ナオ'], ['ノブヒコ', 'のぶひこ', 'ノブヒコ'], ['育子', 'いくこ', 'イクコ'], ['満', 'みつる', 'ミツル'], ['扶樹', 'もとき', 'モトキ'], ['涼', 'りょう', 'リョウ'], ['雅功', 'まさとし', 'マサトシ'], ['まひる', 'まひる', 'マヒル'], ['みゆき', 'みゆき', 'ミユキ'], ['薫', 'かおる', 'カオル'], ['りえ', 'りえ', 'リエ'], ['未來', 'みらい', 'ミライ'], ['寿々花', 'すずか', 'スズカ'], ['あい', 'あい', 'アイ'], ['明', 'あきら', 'アキラ'], ['由美子', 'ゆみこ', 'ユミコ'], ['碧海', 'おうが', 'オウガ'], ['ケンイチ', 'けんいち', 'ケンイチ'], ['育二', 'いくじ', 'イクジ'], ['ヒロ', 'ひろ', 'ヒロ'], ['まひる', 'まひる', 'マヒル'], ['那奈', 'なな', 'ナナ'], ['草太', 'そうた', 'ソウタ'], ['愛梨', 'あいり', 'アイリ'], ['秀樹', 'ひでき', 'ヒデキ'], ['了', 'りょう', 'リョウ'], ['涼', 'りょう', 'リョウ'], ['美希', 'みき', 'ミキ'], ['雅功', 'まさとし', 'マサトシ'], ['俊介', 'しゅんすけ', 'シュンスケ'], ['勇一', 'ゆういち', 'ユウイチ'], ['直人', 'なおと', 'ナオト'], ['南朋', 'なお', 'ナオ'], ['紗季', 'さき', 'サキ'], ['エリカ', 'えりか', 'エリカ'], ['恵子', 'けいこ', 'ケイコ'], ['明日', 'めいび', 'メイビ'], ['はるか', 'はるか', 'ハルカ'], ['愛', 'あい', 'アイ'], ['さとみ', 'さとみ', 'サトミ'], ['亮', 'りょう', 'リョウ'], ['玲那', 'れな', 'レナ'], ['鉄洋', 'てつひろ', 'テツヒロ'], ['砂羽', 'さわ', 'サワ'], ['幸平', 'こうへい', 'コウヘイ'], ['優', 'ゆう', 'ユウ'], ['朝香', 'あさか', 'アサカ'], ['浩介', 'こうすけ', 'コウスケ'], ['満', 'みつる', 'ミツル'], ['育子', 'いくこ', 'イクコ'], ['なぎさ', 'なぎさ', 'ナギサ'], ['一樹', 'かずき', 'カズキ'], ['満', 'みつる', 'ミツル'], ['慎之介', 'しんのすけ', 'シンノスケ'], ['真悠子', 'まゆこ', 'マユコ'], ['千夏', 'ちなつ', 'チナツ'], ['花', 'はな', 'ハナ'], ['さとみ', 'さとみ', 'サトミ'], ['一徳', 'いっとく', 'イットク'], ['知世', 'ちせ', 'チセ'], ['恵子', 'けいこ', 'ケイコ'], ['なつみ', 'なつみ', 'ナツミ'], ['愛子', 'あいこ', 'アイコ'], ['雅功', 'まさとし', 'マサトシ'], ['まさし', 'まさし', 'マサシ'], ['明慶', 'あきよし', 'アキヨシ'], ['美智子', 'みちこ', 'ミチコ'], ['真帆', 'まほ', 'マホ'], ['一哉', 'かずや', 'カズヤ'], ['知史', 'ともふみ', 'トモフミ'], ['ひかり', 'ひかり', 'ヒカリ'], ['啓介', 'けいすけ', 'ケイスケ'], ['遥', 'はるか', 'ハルカ'], ['美咲', 'みさき', 'ミサキ'], ['正義', 'まさよし', 'マサヨシ'], ['えみ', 'えみ', 'エミ'], ['寛', 'ひろし', 'ヒロシ'], ['芽以', 'めい', 'メイ'], ['浩太郎', 'こうたろう', 'コウタロウ'], ['聡', 'さとし', 'サトシ'], ['結子', 'ゆうこ', 'ユウコ'], ['遥', 'はるか', 'ハルカ'], ['雅彦', 'まさひこ', 'マサヒコ'], ['洋', 'よう', 'ヨウ'], ['勇介', 'ゆうすけ', 'ユウスケ'], ['崇史', 'たかし', 'タカシ'], ['陽子', 'ようこ', 'ヨウコ'], ['陽子', 'ようこ', 'ヨウコ'], ['ジョージ', 'じょーじ', 'ジョージ'], ['彩', 'あや', 'アヤ'], ['れいな', 'れいな', 'レイナ'], ['努', 'つとむ', 'ツトム'], ['みあ', 'みあ', 'ミア'], ['美菜', 'みな', 'ミナ'], ['有起哉', 'ゆきや', 'ユキヤ'], ['直人', 'なおと', 'ナオト'], ['雅彦', 'まさひこ', 'マサヒコ'], ['千夏', 'ちなつ', 'チナツ'], ['草太', 'そうた', 'ソウタ'], ['優', 'ゆう', 'ユウ'], ['めぐみ', 'めぐみ', 'メグミ'], ['そら', 'そら', 'ソラ'], ['幸平', 'こうへい', 'コウヘイ'], ['佳乃', 'よしの', 'ヨシノ'], ['みあ', 'みあ', 'ミア'], ['大樹', 'ひろき', 'ヒロキ'], ['はじめ', 'はじめ', 'ハジメ'], ['晴臣', 'はるおみ', 'ハルオミ'], ['奈々', 'なな', 'ナナ'], ['圭', 'けい', 'ケイ'], ['窈', 'よう', 'ヨウ'], ['利夫', 'としお', 'トシオ'], ['礼子', 'れいこ', 'レイコ'], ['隆博', 'たかひろ', 'タカヒロ'], ['茜', 'あかね', 'アカネ'], ['薫', 'かおる', 'カオル'], ['美咲', 'みさき', 'ミサキ'], ['三省', 'さんせい', 'サンセイ'], ['咲', 'さき', 'サキ'], ['ひろ子', 'ひろこ', 'ヒロコ'], ['進', 'すすむ', 'ススム'], ['美咲', 'みさき', 'ミサキ'], ['右京', 'うきょう', 'ウキョウ'], ['美幸', 'みゆき', 'ミユキ'], ['直人', 'なおと', 'ナオト'], ['窈', 'よう', 'ヨウ'], ['ひろみ', 'ひろみ', 'ヒロミ'], ['高史', 'たかし', 'タカシ'], ['丈雄', 'たけお', 'タケオ'], ['広之', 'ひろゆき', 'ヒロユキ'], ['寿々花', 'すずか', 'スズカ'], ['詩織', 'しおり', 'シオリ'], ['禄郎', 'ろくろう', 'ロクロウ'], ['恵子', 'けいこ', 'ケイコ'], ['佳乃', 'よしの', 'ヨシノ'], ['南朋', 'なお', 'ナオ'], ['明慶', 'あきよし', 'アキヨシ'], ['麻緒', 'まお', 'マオ'], ['彩華', 'あやか', 'アヤカ'], ['一哉', 'かずや', 'カズヤ'], ['高史', 'たかし', 'タカシ'], ['遥', 'はるか', 'ハルカ'], ['惇', 'じゅん', 'ジュン'], ['涼子', 'りょうこ', 'リョウコ'], ['莉央', 'りお', 'リオ'], ['慎之介', 'しんのすけ', 'シンノスケ'], ['一徳', 'いっとく', 'イットク'], ['季衣', 'としえ', 'トシエ'], ['友也', 'ともや', 'トモヤ'], ['竜也', 'たつや', 'タツヤ'], ['直人', 'なおと', 'ナオト'], ['桃子', 'ももこ', 'モモコ'], ['仁', 'じん', 'ジン'], ['さんま', 'さんま', 'サンマ'], ['涼子', 'りょうこ', 'リョウコ'], ['ヒカル', 'ひかる', 'ヒカル'], ['千夏', 'ちなつ', 'チナツ'], ['沙知絵', 'さちえ', 'サチエ'], ['高史', 'たかし', 'タカシ'], ['栄一', 'えいいち', 'エイイチ'], ['聡', 'さとし', 'サトシ'], ['未華子', 'みかこ', 'ミカコ'], ['洋', 'よう', 'ヨウ'], ['達士', 'たつひと', 'タツヒト'], ['真悠子', 'まゆこ', 'マユコ'], ['功補', 'こうすけ', 'コウスケ'], ['景子', 'けいこ', 'ケイコ'], ['菊生', 'きくお', 'キクオ'], ['一代', 'かずよ', 'カズヨ'], ['夏空', 'そら', 'ソラ'], ['みあ', 'みあ', 'ミア'], ['和久', 'かずひさ', 'カズヒサ'], ['佑', 'たすく', 'タスク'], ['翔', 'しょう', 'ショウ'], ['千佳子', 'ちかこ', 'チカコ'], ['晃司', 'こうじ', 'コウジ'], ['米蔵', 'よねぞう', 'ヨネゾウ'], ['里奈', 'りな', 'リナ'], ['英嗣', 'ひでつぐ', 'ヒデツグ'], ['晃司', 'こうじ', 'コウジ'], ['みき', 'みき', 'ミキ'], ['賢二', 'けんじ', 'ケンジ'], ['康文', 'やすふみ', 'ヤスフミ'], ['敏也', 'としや', 'トシヤ'], ['英嗣', 'ひでつぐ', 'ヒデツグ'], ['賢治', 'けんじ', 'ケンジ'], ['慶太', 'けいた', 'ケイタ'] ]

  @@prefecture_list = %w(北海道 青森県 岩手県 宮城県 秋田県 山形県 福島県 茨城県 栃木県 群馬県 埼玉県 千葉県 東京都 神奈川県 新潟県 富山県 石川県 福井県 山梨県 長野県 岐阜県 静岡県 愛知県 三重県 滋賀県 京都府 大阪府 兵庫県 奈良県 和歌山県 鳥取県 島根県 岡山県 広島県 山口県 徳島県 香川県 愛媛県 高知県 福岡県 佐賀県 長崎県 熊本県 大分県 宮崎県 鹿児島県 沖縄県)

  @@postcode_list = %w(011-0921 017-0044 020-0501 027-0373 029-5703 036-8601 039-2812 048-1253 059-1431 064-8644 071-0233 078-2531 084-8555 089-1321 097-0017 100-6178 102-8407 105-7206 108-8582 133-0055 151-8567 163-0828 180-8522 203-0002 223-0063 243-0301 257-0031 270-1533 285-0062 290-0047 299-1613 300-2657 308-0857 314-0255 321-2343 327-0822 336-0903 349-0205 356-8567 369-0137 372-0841 380-0946 389-0696 399-4598 409-1205 415-0012 422-8567 431-3314 440-8506 444-0847 449-0403 457-0023 464-8540 471-0013 480-1341 488-0081 492-8463 500-8859 501-6013 504-0861 509-5131 513-0016 517-0204 520-0353 523-8503 530-6025 546-0003 569-0044 577-8567 591-8032 600-8540 602-8247 604-8456 607-8347 614-8305 620-0003 629-0154 633-0314 639-1134 644-0041 649-7167 656-1602 665-8665 669-3892 671-4215 678-0072 680-8021 689-3334 698-0027 702-8045 709-3723 720-0013 730-0032 737-0838 744-0042 755-0013 762-0066 771-5514 781-1520 787-0019 791-8067 798-3392 804-8601 811-3514 819-0037 832-0012 841-0075 851-0126 857-4416 861-0915 866-0874 870-0874 876-1106 880-8507 891-0502 897-0303 902-8521 910-2524 916-0063 920-0057 922-0312 926-8501 930-0208 933-0038 939-0244 939-8041 942-1428 949-0112 950-0823 952-1537 959-0232 959-3933 962-0044 964-0935 969-4402 979-2707 983-8565 988-0055 989-5503 994-0007 999-6100)

  @@char_list = ('ぁ'..'ん').to_a
end

# 出力の基底クラス
class RowPrinter
  attr_accessor :table_name
  attr_accessor :columns

  def print_header
    return ''
  end

  def print_footer
    return ''
  end
end

# SQLで出力するクラス
class SQLPrinter < RowPrinter
  def print_row(row, i, count)
    ret = ''
    if i % 100 == 0
      ret += "INSERT INTO #{@table_name} ("
      ret += @columns.map {|column| column[:column_name].to_s}.join(', ')
      ret += ") VALUES\n"
    else
      ret += ','
    end
    ret += "(" + row.map {|x| "'" + (x.is_a?(String) ? x.gsub("'", "\\\\'") : x.to_s) + "'"}.join(', ') + ")\n"

    if i % 100 == 99 || i == count - 1
      ret += ";\n"
    end

    return ret
  end
end

# JSONで出力するクラス
class JSONPrinter < RowPrinter
  def print_header
    return "[\n"
  end

  def print_row(row, i, count)
    ret = ''
    h = Hash.new
    @columns.each_with_index {|column, i|
      h[column[:column_name]] = row[i]
    }
    return h.to_json + (i == count - 1 ? '' : ',') + "\n"
  end

  def print_footer
    return "]\n"
  end
end

# CSVで出力するクラス
class CSVPrinter < RowPrinter
  attr_accessor :separator

  def print_header
    return @columns.map {|column| column[:column_name].to_s}.join(@separator) + "\n"
  end

  def print_row(row, i, count)
    ret = ''
    ret += row.join(@separator) + "\n"
    return ret
  end
end


#--- main --------------------------------------------------------------------------w
if __FILE__ == $0

  lib_filename = 'mktestdata_lib.rb'
  template_filename = 'generate.rb'

  if not File.exist?(template_filename)
    open(template_filename, 'w') {|f|
      f.write(TestDataGenerator.template)
    }
    puts "#{template_filename} をカレントディレクトリに作成しました。"
  else
    puts "#{template_filename} が既に存在するため作成しません。再生成するには一度 #{template_filename} を削除してください。"
  end

  puts "ruby #{template_filename} でテストデータが出力されます。"
end
