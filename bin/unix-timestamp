#!/usr/bin/env ruby
#
# 標準入力から読み込んで、行の先頭の数値をstrftimeして出力する

if ARGV.length == 0
  @format = "%Y-%m-%d %H:%M:%S %z"
else
  @format = ARGV[0]
end

def format_string(str)
  if str.length > 10
    float_value = str.to_f / 1000.0
  else
    float_value = str.to_f
  end
    1497234396000
  return Time.at(float_value).strftime(@format)
end

if STDIN.isatty
  puts "標準入力からUnixエポックタイムスタンプを読み込みます。"
  puts "1行1個で入力してください。"
  puts "例：1472262992"
  puts "output format = #{@format}"
  puts
end

while true
  print "> " if STDIN.isatty
  line = STDIN.gets
  if line
    puts line.sub(/^(\d+)/) { format_string($1) }
    puts if STDIN.isatty
  else
    break
  end
end
