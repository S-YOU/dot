#!/bin/sh

set -e

zip="$1"
dir="${1/.*/}"
tmp="uzip.tmp"

#echo "zip=$zip"
#echo "dir=$dir"

if [ -d "$dir" ]; then
    "Directory already exists: $dir"
    exit 1
fi

mkdir "$tmp"
unzip "$zip" -d "$tmp"
file_count=$(ls -A "$tmp" | wc -l)

if [ "$file_count" = 1 ]; then
    mv -i "$tmp"/* .
    rmdir "$tmp"
    echo "\x1b[1;32mカレントディレクトリに展開しました。行儀のいいzipでした。\x1b[0m"
else
    mv -iv "$tmp" "$dir"
    echo -e "\x1b[1;32m$dir に展開しました。行儀の悪いzipでした。\x1b[0m"
fi

rm -rf "$tmp"
