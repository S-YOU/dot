#!/bin/sh

set -e

zip="$1"
dir="${1%.*}"
tmp="uzip.tmp"

#echo "zip=$zip"
#echo "dir=$dir"

if [ -d "$dir" ]; then
    echo "Directory already exists: $dir" 1>&2
    exit 1
fi

mkdir "$tmp"
unzip "$zip" -d "$tmp"
ls_result=$(ls -A "$tmp")
file_count=$(echo "$ls_result" | wc -l)

if [ "$file_count" = 1 ]; then
    mv -i "$tmp"/* .
    rmdir "$tmp"
    echo -e "\x1b[1;34m${ls_result}\x1b[0m に展開しました。行儀のいいzipでした。"
else
    mv -iv "$tmp" "$dir"
    echo -e "\x1b[1;34m$dir\x1b[0m に展開しました。行儀の悪いzipでした。"
fi

rm -rf "$tmp"
