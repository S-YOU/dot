#!/usr/bin/env ruby
# encoding: utf-8

require "cgi"
require "shellwords"

xpath = ARGV[0]
xml = $stdin.read
pipe = IO.popen("xmllint --noent --encode UTF-8 --xpath #{Shellwords.shellescape(xpath)} -", "r+")
pipe.write xml
pipe.close_write
extracted = pipe.read
puts CGI.unescape_html(extracted)
