# vim: set ts=4 sts=4 sw=4 et ft=sh: 
# bashとzsh共通のalias

alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'
alias ,='pushd +1 > /dev/null'
alias ,,='pushd +2 > /dev/null'
alias ,,,='pushd +3 > /dev/null'
alias ,,,,='pushd +4 > /dev/null'
alias ag='ag --follow'
alias bg=' bg'
alias com='command'
alias cp='cp -i'
case "$OSTYPE" in
    *darwin*)
        alias cop='pbcopy'
        alias pas='pbpaste'
        ;;
esac
alias fg=' fg'
alias gdb='gdb --quiet -ex start'
alias gti='git'
alias gosh='rlwrap --histsize 10000 -q "\"" --break-chars "(){}[].,#@;|\`\"" -f . -f ~/.vim/dict/schemedict.txt --complete-filenames gosh'
alias la='ls -a'
# ls
case "$OSTYPE" in
    *bsd*)
        alias ls='ls -AG'
        ;;
    *darwin*)
        alias ls='ls -AG'
        ;;
    *)
        alias ls='ls --color=auto'
        ;;
esac
alias ll='ls -lrth'
alias lsdot='ls -ld ~/.*'
alias lsdotl='CLICOLOR_FORCE=1 lsdot | grep -e "->"'
alias r='$DOT/bin/r'
alias rm='$DOT/bin/rma.sh'
alias pt='pt --follow'
alias st='git st'
alias tf='tail -f -n 500'
alias vi='vim'
alias vil='vim -c "nnoremap q :q!<CR>" -c "set t_ti= t_te= buftype=nofile nonumber wrap laststatus=1" -c "nunmap <C-p>"  -'
alias vissh='vi ~/.ssh/config'
alias wget='wget --no-check-certificate --content-disposition'

awsenv() {
    local rbpath="$DOT/bin/awsenv.rb"
    if [ "$1" = "" ]; then
        ruby "$rbpath"
    else
        eval $(ruby "$rbpath" "$@")
        ruby "$rbpath"
    fi
}

ghc() {
    which stack > /dev/null
    if [ $? = 0 ]; then
        stack --verbosity silent ghc -- -O "$@"
    else
        command ghc "$@"
    fi
    command rm *.hi *.o
}

ghci() {
    which stack > /dev/null
    if [ $? = 0 ]; then
        stack --verbosity silent ghci -- "$@"
    else
        command ghci "$@"
    fi
}

is_screen() {
  case "$TERM" in
    *screen*)
      return 0
      ;;
    *)
      return 1
      ;;
  esac
}

jq() {
    if [ -t 1 ]; then
        OPT="-C"
    else
        OPT=""
    fi
    if [ "$1" = "" ]; then
        set -- .
    fi
    command jq $OPT "$@" | less
}

man() {
    env LESS_TERMCAP_mb=$'\E[01;31m' \
    LESS_TERMCAP_md=$'\E[01;38;5;197m' \
    LESS_TERMCAP_me=$'\E[0m' \
    LESS_TERMCAP_ue=$'\E[0m' \
    LESS_TERMCAP_us=$'\E[04;38;5;129m' \
    man "$@"
}

md() {
    mkdir -p "$1" && cd "$1"
}

mv() {
    for last; do true; done
    dir=$(dirname "$last")
    if [ ! -d "$dir" ]; then
        echo "$dir not exist."
        echo -n "Create directory? [y/N]"
        read answer
        if [ "$answer" = "y" ]; then
            mkdir -pv "$dir"
        fi
    fi
    command mv -iv "$@"
}

l() {
    if [ ! -t 0 ]; then
        less "$@"
    elif [ -d "$1" ]; then
        ls -lrt "$@"
    elif [ -f "$1" ]; then
        less "$@"
    else
        ls -lrt
    fi
}

# 任意のコマンドをlessでページング対応させる関数
pagerize() {
    local cmd="$1"
    shift
    local src="
    $cmd() {
        if [ -t 1 ]; then
            command $cmd \"\$@\" | less -F
        else
            command $cmd \"\$@\"
        fi
    }
"
    eval "$src"
}

pagerize find
pagerize locate
pagerize readelf
pagerize tree
pagerize xxd

. $DOT/bin/pathmunge

ps() {
    if [ $# = 0 ]; then
        case "$OSTYPE" in
            *linux*)
                command ps axfo user,pid,pgid,tty,ni,rss,vsz,stat,wchan=WIDE-WCHAN-COLUMN,start,args | less +G
                ;;
            *)
                command ps axo user,pid,pgid,tty,ni,rss,vsz,stat,start,args | less +G
                ;;
        esac
    else
        command ps "$@" | less +G
    fi
}

runghc() {
    which stack > /dev/null
    if [ $? = 0 ]; then
        stack --verbosity silent runghc -- "$@"
    else
        command runghc -- "$@"
    fi
}

svn() {
    if [ -t 1 -a "$1" = "ci" -o "$1" = "pe" ]; then
        command svn "$@"
    else
        FORCE_COLOR=true command svn "$@" | less -F
    fi
}

tt() {
    if [ -t 1 ]; then
        cd $(pjroot)
    else
        pjroot
    fi
}

xf() {
    if [ -t 1 ]; then
        xmllint --format - > /tmp/xf.$$ && vil < /tmp/xf.$$
    else
        xmllint --format -
    fi
}

BMDIR=~/bm

bmhelp() {
    cat <<EOF
Usage:
    bm add .            -- Bookmark current directory
    bm add . hoge       -- Bookmark current directory as 'hoge'
    bm ls               -- List bookmarks
    bm rm hoge          -- Remove bookmark 'hoge'
EOF
    return $1
}

bm() {
    if [ ! -d "$BMDIR" ]; then
        mkdir -p "$BMDIR"
    fi

    case "$1" in
        add)
            if [ "$2" = "" ]; then
                bmhelp 1
                return
            fi
            TARGET=`realpath "$2"`
            if [ "$3" =  "" ]; then
                BASENAME=`basename "$TARGET"`
                BMNAME="$BASENAME"
            else
                BMNAME="$3"
            fi
            ln -sv "$TARGET" "$BMDIR"/"$BMNAME"
            ;;
        ls)
            ls -l "$BMDIR"
            ;;
        rm)
            if [ "$2" != "" ]; then
                rm -v "$BMDIR/$2"
            fi
            ;;
        "")
            bmhelp
            ;;
        *)
            if [ -L "$BMDIR/$1" ]; then
                cd "$BMDIR/$1"
            else
                bmhelp 1
            fi
            ;;
    esac
}
